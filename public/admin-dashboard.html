<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ê–¥–º–∏–Ω</title>
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="dashboard">
    <header class="dashboard-header">
        <div class="header-content">
            <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="voting-control" onclick="switchTab('voting-control')">
                    ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º
                </button>
                <button class="nav-tab" data-tab="shifts-candidates" onclick="switchTab('shifts-candidates')">
                    üë• –°–º–µ–Ω—ã –∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
                </button>
                <button class="nav-tab" data-tab="voters" onclick="switchTab('voters')">
                    üìã –°–ø–∏—Å–æ–∫ –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π
                </button>
                <button class="nav-tab" data-tab="audit-log" onclick="switchTab('audit-log')">
                    üìä –ñ—É—Ä–Ω–∞–ª –≥–æ–ª–æ—Å–æ–≤
                </button>
                <button class="nav-tab" data-tab="results" onclick="switchTab('results')">
                    üìà –ò—Ç–æ–≥–æ–≤–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å
                </button>
            </nav>
            <div class="user-info">
                <span id="admin-username">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <button class="btn-reset-db" onclick="resetDatabase()" title="–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –ë–î</button>
                <button class="btn-change-password" onclick="showChangePasswordModal()">üîê –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                <button class="btn-logout" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <div class="dashboard-content">
        <!-- Alerts -->
        <div id="alert-container"></div>

        <!-- Tab: Voting Control -->
        <div id="tab-voting-control" class="tab-content active">
            <section class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
                        <div id="voting-status" class="stat-value">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤</div>
                        <div id="total-votes" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        <div id="total-voters" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
                        <div id="results-status" class="stat-value">–ù–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã</div>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-success" onclick="controlVoting('start')">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                    <button class="btn btn-warning" onclick="controlVoting('pause')">‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn btn-danger" onclick="controlVoting('stop')">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="controlVoting('reset')">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
                <div class="control-buttons" style="margin-top: 20px;">
                    <button class="btn btn-primary btn-large" onclick="publishResults()">üèÜ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    <button class="btn btn-secondary" onclick="unpublishResults()">üîí –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                </div>
            </section>
        </div>

        <!-- Tab: Shifts and Candidates -->
        <div id="tab-shifts-candidates" class="tab-content">
            <section class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–∞–º–∏</h2>
                <button class="btn btn-primary" onclick="showAddShiftModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É</button>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="shifts-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–ê–∫—Ç–∏–≤–Ω–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="section" style="margin-top: 30px;">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏</h2>
                <button class="btn btn-primary" onclick="showAddCandidateModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="candidates-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–°–º–µ–Ω–∞</th>
                                <th>–ò–º—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Tab: Voters Management -->
        <div id="tab-voters" class="tab-content">
            <section class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π</h2>
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-label">–í—Å–µ–≥–æ –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π</div>
                        <div id="voters-total" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–æ</div>
                        <div id="voters-voted" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</div>
                        <div id="voters-remaining" class="stat-value">0</div>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="showUploadVotersModal()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <button class="btn btn-secondary" onclick="exportVoters()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                    <button class="btn btn-warning" onclick="resetVotersStatus()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</button>
                    <button class="btn btn-danger" onclick="clearVoters()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="voters-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–§–ò–û</th>
                                <th>–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª</th>
                                <th>–î–∞—Ç–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Tab: Audit Log (Journal with full info) -->
        <div id="tab-audit-log" class="tab-content">
            <section class="section">
                <h2>–ñ—É—Ä–Ω–∞–ª –≥–æ–ª–æ—Å–æ–≤</h2>
                <p style="color: #666; margin-bottom: 15px;">
                    –ü–æ–ª–Ω—ã–π –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤ —Å –§–ò–û –∏ VK ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–µ–≥–∏—Ç–∏–º–Ω–æ—Å—Ç–∏.
                    –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–æ–ª–æ—Å–∞ –≤ —Å–ª—É—á–∞–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π.
                </p>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="audit-log-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">ID</th>
                                <th style="width: 150px;">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                                <th style="width: 250px;">–§–ò–û (–∞–Ω–∫–µ—Ç–∞)</th>
                                <th style="width: 200px;">–ü—Ä–æ—Ñ–∏–ª—å –í–ö</th>
                                <th style="width: 120px;">–°—Ç–∞—Ç—É—Å</th>
                                <th style="width: 120px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="audit-log-body">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Tab: Results (–∏—Ç–æ–≥–æ–≤–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å) -->
        <div id="tab-results" class="tab-content">
            <section class="section">
                <h2>–ò—Ç–æ–≥–æ–≤–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å</h2>
                <div id="results-status-message" class="alert" style="margin-bottom: 20px;">
                    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ -->
                </div>
                <p style="color: #666; margin-bottom: 15px;">
                    –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∑–∞ –∫–æ–≥–æ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –ø–æ —Å–º–µ–Ω–∞–º.
                    –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (VK ID, –Ω–∞—Å—Ç–æ—è—â–µ–µ –§–ò–û) —Å–∫—Ä—ã—Ç—ã –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏.
                    –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–∞ –æ—Ç–º–µ—á–µ–Ω—ã –∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ–¥—Å—á—ë—Ç–µ.
                </p>
                <button class="btn btn-secondary" onclick="exportVotes()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="results-table">
                        <thead id="results-table-head">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </thead>
                        <tbody id="results-table-body">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal for Add Shift -->
    <div id="shift-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É</h2>
                <button class="modal-close" onclick="closeModal('shift-modal')">&times;</button>
            </div>
            <form id="shift-form">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã*</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="description"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                        <input type="date" name="startDate">
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="date" name="endDate">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- Modal for Add Candidate -->
    <div id="candidate-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h2>
                <button class="modal-close" onclick="closeModal('candidate-modal')">&times;</button>
            </div>
            <form id="candidate-form">
                <div class="form-group">
                    <label>–°–º–µ–Ω–∞*</label>
                    <select name="shiftId" required id="candidate-shift-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–º–µ–Ω—É</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ò–º—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞*</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="description"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- Modal for Upload Voters -->
    <div id="voters-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π</h2>
                <button class="modal-close" onclick="closeModal('voters-modal')">&times;</button>
            </div>
            <form id="voters-form">
                <div class="form-group">
                    <label>–°–ø–∏—Å–æ–∫ –§–ò–û –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π (–∫–∞–∂–¥–æ–µ –§–ò–û —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)*</label>
                    <textarea
                        name="voters"
                        id="voters-textarea"
                        required
                        rows="15"
                        placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á&#10;–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á&#10;–°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞&#10;..."></textarea>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        –ö–∞–∂–¥–æ–µ –§–ò–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ. –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –∏ –ø—Ä–æ–±–µ–ª—ã.
                    </small>
                </div>
                <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- Modal for Cancel Vote -->
    <div id="cancel-vote-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–æ–ª–æ—Å</h2>
                <button class="modal-close" onclick="closeModal('cancel-vote-modal')">&times;</button>
            </div>
            <form id="cancel-vote-form">
                <input type="hidden" id="cancel-vote-id" name="voteId">
                <div class="form-group">
                    <label>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ:</label>
                    <div id="cancel-vote-info" style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏—á–∏–Ω–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è*</label>
                    <textarea
                        name="reason"
                        id="cancel-reason"
                        required
                        rows="4"
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª –Ω–µ —Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–±–æ–π –∏ —Ç.–¥.)"></textarea>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        –ü—Ä–∏—á–∏–Ω–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –∂—É—Ä–Ω–∞–ª–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
                    </small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('cancel-vote-modal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-danger">–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–æ–ª–æ—Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Change Password -->
    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
                <button class="modal-close" onclick="closeModal('change-password-modal')">&times;</button>
            </div>
            <form id="change-password-form">
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å*</label>
                    <input type="password" name="oldPassword" id="old-password" required autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å* (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                    <input type="password" name="newPassword" id="new-password" required minlength="6" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å*</label>
                    <input type="password" name="confirmPassword" id="confirm-password" required minlength="6" autocomplete="new-password">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('change-password-modal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/admin.js"></script>
</body>
</html>
