# Обновление приватности в журнале голосов

## Что изменилось

Журнал голосов в админ-панели теперь **не показывает персональные данные** избирателей для обеспечения анонимности голосования.

### До изменений
Таблица содержала:
- Время голосования
- VK ID пользователя (ссылка на профиль)
- Настоящее ФИО
- Псевдоним
- Смена
- Кандидат
- Тип голоса

❌ Администратор мог идентифицировать личность голосующего

### После изменений
Таблица содержит только:
- Псевдоним
- Колонки для каждой смены с выбором кандидата

✅ Администратор видит только псевдонимы и выборы, без возможности идентификации личности

## Новый формат таблицы

| Псевдоним | Смена "Камертон" | Смена "Искра" | Смена "Звезда" |
|-----------|------------------|---------------|----------------|
| Зелённый слоник | Анисимов Владимир | Кристина Романова | Против всех |
| Лунный волк | Петров Иван | Воздержался | Сидорова Мария |
| Синий кот | Против всех | Иванов Алексей | - |

### Пояснения к таблице:
- **Псевдоним** - выбран пользователем при голосовании в боте
- **Колонки смен** - динамически создаются на основе существующих смен с голосами
- **Значения ячеек**:
  - Имя кандидата (зелёный бейдж)
  - "Против всех" (красный бейдж)
  - "Воздержался" (серый бейдж)
  - "-" (если не голосовал на этой смене)

## Преимущества новой структуры

1. **Анонимность** - нельзя узнать, кто конкретно голосовал
2. **Компактность** - вся информация о голосах пользователя в одной строке
3. **Удобство** - легко увидеть паттерны голосования
4. **Горизонтальная прокрутка** - первая колонка (псевдоним) зафиксирована при прокрутке

## Экспорт в CSV

CSV файл теперь имеет формат:

```csv
Псевдоним,"Смена 1","Смена 2","Смена 3"
"Зелённый слоник","Анисимов Владимир","Кристина Романова","Против всех"
"Лунный волк","Петров Иван","Воздержался","Сидорова Мария"
```

## Технические изменения

### Backend
- [Vote.js](src/models/Vote.js:171) - новые методы:
  - `getGroupedByNickname()` - группировка голосов по псевдониму
  - `getAllShiftNames()` - получение списка смен для заголовков

- [adminController.js](src/controllers/adminController.js:99) - обновлены методы:
  - `getAllVotes()` - теперь возвращает сгруппированные данные
  - `exportVotes()` - экспорт в новом формате

### Frontend
- [admin-dashboard.html](public/admin-dashboard.html:164) - обновлена структура таблицы
- [admin.js](public/js/admin.js:319) - новая функция `renderVotes()` для отображения
- [admin.css](public/css/admin.css:360) - стили для фиксированной колонки псевдонимов

## Обратная совместимость

Существующие данные в базе сохраняются полностью. Изменился только способ отображения в админ-панели.

Через API `/api/users/:vkId/stats` пользователь по-прежнему может получить свою статистику.

## Безопасность

Теперь администратор **не может**:
- Узнать VK ID голосовавших
- Увидеть настоящее ФИО из бота
- Установить связь между псевдонимом и реальной личностью (если псевдоним выбран анонимно)

Это защищает избирателей от потенциального давления или преследования за их выбор.
